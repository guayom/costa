<%= form.file_field(field.name, field.html_attributes.reverse_merge({ multiple: true, data: { fileupload: true }})) %>

<% form.object.imagenes.each do |image| %>
  <div class="image-form-preview" id="image_<%= image.id %>">
    <%= link_to(image.imagen.url, target: 'blank') do %>
      <%= image_tag image.imagen.url(:small), class: image.id.to_s == form.object.cover ? 'cover' : '' %>
    <% end %>
    <% if image.id.present? %>
      <div class="clearfix"></div>
      <p class="pull-right" style="padding-right: 15px;">
        <%= link_to 'Cover', main_app.cover_propiedad_path(cover: image.id), remote: true %>
      </p>

      <p align="left">
        <%= link_to "Eliminar", destroy_image_path(:imagen, image.id), method: :delete, remote: true, data: {confirm: '¿Está seguro?'} %>
      </p>
    <% end %>
  </div>
<% end %>

<% if form.object.imagenes.any? %>
  <br>
  <a id="delete_all_images" href="#">Eliminar todos</a>
  <script>
    $(function() { $('#delete_all_images:not(.bound)').addClass('bound').click(deleteAllImages); });
    $(document).on('pjax:complete', function() { $('#delete_all_images:not(.bound)').addClass('bound').click(deleteAllImages); });

    var deleteAllImages = function(event) {
      if (!confirm('¿Está seguro?')) {
        return false;
      }

      var deletePath = [
        <% form.object.imagenes.each do |image| %>
        '<%= destroy_image_path(:imagen, image.id) %>',
        <% end %>
      ];

      for (var i = 0; i < deletePath.length; i++) {
        $.ajax({
          url: deletePath[i],
          type: 'DELETE',
          beforeSend: function(xhr) {
            xhr.setRequestHeader(
                'X-CSRF-Token',
                $('meta[name=csrf-token]').attr('content')
            );
          }
        });
      }

      event.preventDefault();
      return false;
    };
  </script>
<% end %>
